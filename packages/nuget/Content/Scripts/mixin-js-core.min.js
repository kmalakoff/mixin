// Generated by CoffeeScript 1.3.3

/*
  mixin-js.js 0.1.4
  (c) 2011, 2012 Kevin Malakoff.
  Mixin is freely distributable under the MIT license.
  See the following for full license details:
    https://github.com/kmalakoff/mixin/blob/master/LICENSE
  Dependencies: None.

  Note: some code from Underscore.js is embedded in this file
  to remove dependencies on the full library. Please see the following for details
  on Underscore.js and its licensing:
    https://github.com/documentcloud/underscore
    https://github.com/documentcloud/underscore/blob/master/LICENSE
*/(function(){var e,t,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};e=this.Mixin=typeof exports!="undefined"?exports:{},e.Core||(e.Core={}),e.VERSION="0.1.4";if(typeof require!="undefined")try{t=require("lodash")}catch(i){t=require("underscore")}else t=this._;t&&t.hasOwnProperty("_")&&(t=t._),t||(t={}),e._=t,t.isArray||(t.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"}),t.isString||(t.isString=function(e){return!!(e===""||e&&e.charCodeAt&&e.substr)}),t.isFunction||(t.isFunction=function(e){return!!(e&&e.constructor&&e.call&&e.apply)}),t.isEmpty||(t.isEmpty=function(e){var n,r;if(t.isArray(e)||t.isString(e))return e.length===0;for(n in e)return r=e[n],!1;return!0}),t.classOf||(t.classOf=function(e){return e instanceof Object?e.prototype&&e.prototype.constructor&&e.prototype.constructor.name?e.prototype.constructor.name:e.constructor&&e.constructor.name?e.constructor.name:void 0:void 0}),t.size||(t.size=function(e){var t,n;t=0;for(n in e)t++;return t}),t.find||(t.find=function(e,t){var n,r,i;for(r=0,i=e.length;r<i;r++){n=e[r];if(t(n))return n}return null}),t.remove||(t.remove=function(e,t){var n;n=e.indexOf(t);if(n<0)return;return e.splice(n,1),t}),t.keypathExists||(t.keypathExists=function(e,n){return!!t.keypathValueOwner(e,n)}),t.keypathValueOwner||(t.keypathValueOwner=function(e,n){var r,i,s,o,u;r=t.isString(n)?n.split("."):n;for(i=o=0,u=r.length;o<u;i=++o){s=r[i];if(i===r.length-1){if(e.hasOwnProperty(s))return e;return}if(!e.hasOwnProperty(s))return;e=e[s]}}),t.keypath||(t.keypath=function(e,n,r){var i;i=n.split("."),e=t.keypathValueOwner(e,i);if(!e)return;return arguments.length===3?(e[i[i.length-1]]=r,r):e[i[i.length-1]]}),e.Core._Validate=function(){function n(){}return n.mixinInfo=function(r,i,s){if(!r)throw new Error(""+s+": mixin_info missing");n.string(r.mixin_name,s,"mixin_name");if(!i&&e.Core._Manager.available_mixins.hasOwnProperty(r.mixin_name))throw new Error(""+s+": mixin_info '"+r.mixin_name+"' already registered");if(!r.mixin_object)throw new Error(""+s+": mixin_info '"+r.mixin_name+"' missing mixin_object");if(!(r.mixin_object instanceof Object))throw new Error(""+s+": mixin_info '"+r.mixin_name+"' mixin_object is invalid");if(r.initialize&&!t.isFunction(r.initialize))throw new Error(""+s+": mixin_info '"+r.mixin_name+"' initialize function is invalid");if(r.destroy&&!t.isFunction(r.destroy))throw new Error(""+s+": mixin_info '"+r.mixin_name+"' destroy function is invalid")},n.instanceAndMixinName=function(e,t,r){if(!e)throw new Error(""+r+": mix_target missing");return n.string(t,r,"mixin_name"),n.instanceOrArray(e,r,"mix_target",t)},n.classConstructorAndMixinName=function(e,r,i){if(!e)throw new Error(""+i+": class constructor missing");n.string(r,i,"mixin_name");if(!t.isFunction(e))throw new Error(""+i+": class constructor invalid for '"+r+"'")},n.exists=function(e,t,n){if(e===void 0)throw new Error(""+t+": "+n+" missing")},n.object=function(e,n,r){if(e===void 0)throw new Error(""+n+": "+r+" missing");if(typeof e!="object"||t.isArray(e))throw new Error(""+n+": "+r+" invalid")},n.uint=function(e,t,n){if(e===void 0)throw new Error(""+t+": "+n+" missing");if(typeof e=="number"||e<0||Math.floor(e)!==e)throw new Error(""+t+": "+n+" invalid")},n.string=function(e,n,r){if(e===void 0)throw new Error(""+n+": "+r+" missing");if(!t.isString(e))throw new Error(""+n+": "+r+" invalid")},n.stringArrayOrNestedStringArray=function(e,n,r){var i,s,o,u;if(e===void 0)throw new Error(""+n+": "+r+" missing");if(!t.isArray(e))throw new Error(""+n+": "+r+" invalid");u=[];for(s=0,o=string_or_array.length;s<o;s++)i=string_or_array[s],u.push(function(){if(t.isArray(i)&&(!i.length||!t.isString(i[0]))||!t.isString(i))throw new Error(""+n+": "+r+" invalid")}());return u},n.callback=function(e,n,r){if(e===void 0)throw new Error(""+n+": "+r+" missing");if(!t.isFunction(e))throw new Error(""+n+": "+r+" invalid")},n.instance=function(e,n,r){if(e===void 0)throw new Error(""+n+": "+r+" missing");if(typeof e!="object"||t.isArray(e)||!t.isFunction(e.constructor)||e.constructor.name==="Object")throw new Error(""+n+": "+r+" invalid")},n.instanceOrArray=function(e,n,r,i){if(e===void 0)throw new Error(""+n+": "+r+" missing");if(typeof e!="object"||!t.isFunction(e.constructor)||e.constructor.name==="Object"||t.isArray(e))throw new Error(""+n+": "+r+" invalid")},n.instanceWithMixin=function(r,i,s,o){n.instance(r,s,o);if(!e.hasMixin(r,i))throw new Error(""+s+": "+o+" missing mixin '"+i+"' on "+t.classOf(r))},n.noKey=function(e,t,n,r){if(e.hasOwnProperty(t))throw new Error(""+n+": "+t+" already exists for "+r)},n.hasKey=function(e,t,n,r){if(!e.hasOwnProperty(t))throw new Error(""+n+": "+t+" does not exist for "+r)},n}(),e.Core._InstanceRecord=function(){function n(e){this.mix_target=e,this.initialized_mixins={}}return n.prototype.destroy=function(){if(!t.isEmpty(this.initialized_mixins))throw new Error("Mixin: non-empty instance record being destroyed");return this.mix_target=null},n.prototype.hasMixin=function(e,t){var n;return n=this.initialized_mixins.hasOwnProperty(e),n||!t?n:(this.initialized_mixins[e]={is_destroyed:!1},!0)},n.prototype.collectMixins=function(e){var t,n,r,i;r=this.initialized_mixins,i=[];for(t in r)n=r[t],i.push(e.push(t));return i},n.prototype.initializeMixin=function(e,t){this.initialized_mixins[e.mixin_name]={is_destroyed:!1,destroy:e.destroy};if(e.initialize)return e.initialize.apply(this.mix_target,t)},n.prototype.destroyMixin=function(e){var t,n,r,i;if(e)return this.initialized_mixins.hasOwnProperty(e)?this._destroyMixinInfo(e):!1;n=!1,i=this.initialized_mixins;for(t in i)r=i[t],n=!0,this._destroyMixinInfo(t);return n},n.prototype._destroyMixinInfo=function(t){var n;return n=this.initialized_mixins[t],n.is_destroyed?!0:(n.is_destroyed=!0,n.destroy&&(n.destroy.apply(this.mix_target),n.destroy=null),e.Core._Manager._destroyInstanceData(this.mix_target,t),delete this.initialized_mixins[t],!0)},n}(),e.Core._ClassRecord=function(){function n(e){this.constructor=e,this.mixins={},this.instance_records=[]}return n.prototype.mixIntoClass=function(e,n){var i,s,o;if(this.mixins.hasOwnProperty(n.mixin_name))return;this.mixins[n.mixin_name]=n;if(!n.force){o=n.mixin_object;for(i in o){s=o[i];if(i in e)throw new Error("Mixin: property '"+i+"' clashes with existing property on '"+t.classOf(e))}}return r(e.constructor.prototype,n.mixin_object)},n.prototype.classHasMixin=function(e){return this.mixins.hasOwnProperty(e)},n.prototype.instanceHasMixin=function(t,n,r){var i;return i=this._getInstanceRecord(t),r?(this.mixins.hasOwnProperty(n)||(this.mixins[n]=e.Core._Manager._getMixinInfo(n)),i||(i=new e.Core._InstanceRecord(t),this.instance_records.push(i)),i.hasMixin(n,r)):i?i.hasMixin(n):!1},n.prototype.collectMixinsForInstance=function(e,t){var n;n=this._getInstanceRecord(t);if(!n)return;return n.collectMixins(e)},n.prototype.initializeInstance=function(t,n,r){var i;i=this._getInstanceRecord(t);if(i){i.initializeMixin(n,r);return}return i=new e.Core._InstanceRecord(t),this.instance_records.push(i),i.initializeMixin(n,r)},n.prototype.destroyInstance=function(e,n){var r,i,s;if(n&&!this.mixins.hasOwnProperty(n))return!1;s=!1,r=this.instance_records.length-1;while(r>=0){i=this.instance_records[r];if(i.mix_target===e&&i.destroyMixin(n)){s=!0,t.isEmpty(i.initialized_mixins)&&(i.destroy(),this.instance_records.splice(r,1));if(n)return!0}r--}return s},n.prototype._getInstanceRecord=function(e){var t,n,r,i;i=this.instance_records;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.mix_target===e)return t}return void 0},n}(),e.Core._Manager=function(){function n(){}return n.available_mixins={},n.registerMixin=function(t,r){return e.DEBUG&&e.Core._Validate.mixinInfo(t,r,"Mixin.registerMixin"),n.available_mixins[t.mixin_name]=t,!0},n.isAvailable=function(e){return n.available_mixins.hasOwnProperty(e)},n._getMixinInfo=function(e){return n.available_mixins[e]},n.mixin=function(r){var i,s,o,u,a,f,l=this;u=function(t,r,i){var s,o;if(e.DEBUG){e.Core._Validate.instanceAndMixinName(t,r,"Mixin.mixin","mix_target");if(!l.isAvailable(r))throw new Error("Mixin.mixin: '"+r+"' not found")}o=n.available_mixins[r];if(!o)throw new Error("Mixin.mixin: '"+r+"' not found");if(l.hasMixin(t,o.mixin_name))return;return s=n._findOrCreateClassRecord(t,o),s.mixIntoClass(t,o),s.initializeInstance(t,o,Array.prototype.slice.call(arguments,2))},i=Array.prototype.slice.call(arguments,1);if(!i.length)throw new Error("Mixin: mixin_name missing");if(i.length>1){s=i[1];if(!(t.isString(s)&&n.isAvailable(s)||t.isArray(s)&&s.length>=1&&t.isString(s[0])&&n.isAvailable(s[0])))return u.apply(this,arguments),r}for(a=0,f=i.length;a<f;a++)o=i[a],t.isArray(o)?u.apply(this,[r].concat(o)):u(r,o);return r},n.mixout=function(t,n){var r,i,s,o,u,a,f,l,c,h=this;e.DEBUG&&e.Core._Validate.instance(t,"Mixin.mixout","mix_target"),s=function(t,n){var r,i,s,o;e.DEBUG&&e.Core._Validate.string(n,"Mixin.mixout","mixin_name");if(t.constructor._mixin_class_records){o=t.constructor._mixin_class_records;for(i=0,s=o.length;i<s;i++){r=o[i];if(r.destroyInstance(t,n))return t}}return t};if(arguments.length>1){l=Array.prototype.slice.call(arguments,1);for(o=0,a=l.length;o<a;o++)i=l[o],s(t,i)}else if(t.constructor._mixin_class_records){c=t.constructor._mixin_class_records;for(u=0,f=c.length;u<f;u++){r=c[u];if(r.destroyInstance(t))return t}}return t},n.hasMixin=function(t,r,i){var s,o;return i?n.hasMixin(t,r)?!0:(o=n.available_mixins[r],o?(s=n._findOrCreateClassRecord(t,o),s.instanceHasMixin(t,r,i)):!1):(e.DEBUG&&e.Core._Validate.instanceAndMixinName(t,r,"Mixin.hasMixin","mix_target"),n.hasInstanceData(t,r)?!0:(s=n._findClassRecord(t,r),s?s.instanceHasMixin(t,r):!1))},n.mixins=function(t){var n,r,i,s,o;e.DEBUG&&e.Core._Validate.instance(t,r,"Mixin.mixins","mix_target"),r=[];if(t.constructor._mixin_class_records){o=t.constructor._mixin_class_records;for(i=0,s=o.length;i<s;i++)n=o[i],n.collectMixinsForInstance(r,t)}return r},n._getClassRecords=function(e){var t,n,r,i,s,o;n=[],r=e.constructor;while(r){if(r._mixin_class_records){o=r._mixin_class_records;for(i=0,s=o.length;i<s;i++)t=o[i],e instanceof t.constructor&&n.push(t)}r=r.__super__&&r.__super__.constructor!==r?r.__super__.constructor:void 0}return n},n._findClassRecord=function(e,t){var n,r,i,s;r=this._getClassRecords(e);for(i=0,s=r.length;i<s;i++){n=r[i];if(n.classHasMixin(t))return n}return void 0},n._findOrCreateClassRecord=function(r,i){var s,o,u,a,f;s=n._findClassRecord(r,i.mixin_name);if(s)return s;r.constructor._mixin_class_records&&(s=t.find(r.constructor._mixin_class_records,function(e){return e.constructor===r.constructor}));if(!s){s=new e.Core._ClassRecord(r.constructor);if(r.constructor._mixin_class_records){f=!1,o=0,u=r.constructor._mixin_class_records.length;while(o<u){a=r.constructor._mixin_class_records[o];if(r instanceof a.constructor){r.constructor._mixin_class_records.splice(o,0,s),f=!0;break}o++}f||r.constructor._mixin_class_records.push(s)}else r.constructor._mixin_class_records=[s];e._statistics&&e._statistics.addClassRecord(s)}return s},n.hasInstanceData=function(t,n){return e.DEBUG&&e.Core._Validate.instanceAndMixinName(t,n,"Mixin.hasInstanceData","mix_target"),!!t._mixin_data&&!!t._mixin_data.hasOwnProperty(n)},n.instanceData=function(r,i,s){if(e.DEBUG){e.Core._Validate.instanceAndMixinName(r,i,"Mixin.instanceData","mix_target");if(s===void 0){if(!("_mixin_data"in r))throw new Error("Mixin.instanceData: no instance data on '"+t.classOf(r)+"'");if(!r._mixin_data.hasOwnProperty(i))throw new Error("Mixin.instanceData: mixin '"+i+"' instance data not found on '"+t.classOf(r)+"'")}else if(!n.hasMixin(r,i))throw new Error("Mixin.instanceData: mixin '"+i+"' not mixed into '"+t.classOf(r)+"'")}return s!==void 0&&(r._mixin_data||(r._mixin_data={}),r._mixin_data[i]=s),r._mixin_data[i]},n._destroyInstanceData=function(e,n){var r;if(!e._mixin_data)return void 0;r=e._mixin_data[n],delete e._mixin_data[n];if(t.isEmpty(e._mixin_data))return delete e._mixin_data},n}(),e.registerMixin=e.Core._Manager.registerMixin,e.isAvailable=e.Core._Manager.isAvailable,e.mixin=e["in"]=e.Core._Manager.mixin,e.mixout=e.out=e.Core._Manager.mixout,e.hasMixin=e.exists=e.Core._Manager.hasMixin,e.mixins=e.Core._Manager.mixins,e.hasInstanceData=e.hasID=e.Core._Manager.hasInstanceData,e.instanceData=e.iD=e.Core._Manager.instanceData,typeof exports!="undefined"&&(exports.Mixin=e),!e&&typeof exports!="undefined"&&(this.Mixin=require("mixin-js-core").Mixin),this.Mixin.STATISTICS===void 0&&(this.Mixin.STATISTICS=!0),e.Core.Statistics=function(){function e(){this.class_records=[]}return e.prototype.addClassRecord=function(e){return this.class_records.push(e)},e.prototype.purge=function(){return this.class_records=[],this.clear()},e.prototype.clear=function(){return this.by_instance_with_data=null,this.by_instance_get_mixins=null,this.by_mixin_get_instances=null,this.by_mixin_get_constructors=null,this.by_constructor_get_instances=null},e.prototype.update=function(){return this.clear(),this.byInstance_getMixins(),this.byInstance_withData(),this.byMixin_getInstances(),this.byMixin_getConstructors(),this.byConstructor_getInstances()},e.prototype.byInstance_getMixins=function(){var e,t,n,r;if(!this.by_instance_get_mixins){this.by_instance_get_mixins=[],r=this.class_records;for(t=0,n=r.length;t<n;t++)e=r[t],this.classRecordGetMixinsByInstance(e,this.by_instance_get_mixins)}return this.by_instance_get_mixins},e.prototype.byInstance_withData=function(){var e,t,n,r;if(!this.by_instance_with_data){this.by_instance_with_data=[],r=this.class_records;for(t=0,n=r.length;t<n;t++)e=r[t],this.classRecordGetInstancesWithData(e,this.by_instance_with_data)}return this.by_instance_with_data},e.prototype.byMixin_getInstances=function(){var e,t,n,r;if(!this.by_mixin_get_instances){this.by_mixin_get_instances={},r=this.class_records;for(t=0,n=r.length;t<n;t++)e=r[t],this.classRecordGetInstancesByMixin(e,this.by_mixin_get_instances)}return this.by_mixin_get_instances},e.prototype.byMixin_getConstructors=function(){var e,t,n,r;if(!this.by_mixin_get_constructors){this.by_mixin_get_constructors={},r=this.class_records;for(t=0,n=r.length;t<n;t++)e=r[t],this.classRecordGetMixins(e,this.by_mixin_get_constructors)}return this.by_mixin_get_constructors},e.prototype.byConstructor_getInstances=function(){var e,t,n,r;if(!this.by_constructor_get_instances){this.by_constructor_get_instances={},r=this.class_records;for(t=0,n=r.length;t<n;t++)e=r[t],this.classRecordGroupInstances(e,this.by_constructor_get_instances)}return this.by_constructor_get_instances},e.prototype.classRecordGetInstancesWithData=function(e,t){var n,r,i,s,o;s=e.instance_records,o=[];for(r=0,i=s.length;r<i;r++)n=s[r],o.push(n.mix_target&&n.mix_target._mixin_data?t.push(n.mix_target):void 0);return o},e.prototype.classRecordGetInstancesByMixin=function(e,t){var n,r,i,s,o,u,a;if(!e.instance_records.length)return;u=e.instance_records,a=[];for(s=0,o=u.length;s<o;s++)n=u[s],a.push(function(){var e,s;e=n.initialized_mixins,s=[];for(r in e)i=e[r],s.push((t.hasOwnProperty(r)?void 0:t[r]=[],t[r].push(n.mix_target)));return s}());return a},e.prototype.classRecordGetMixinsByInstance=function(e,t){var n,r,i,s,o,u,a,f,l;a=e.instance_records,l=[];for(o=0,u=a.length;o<u;o++){n=a[o],s=[],f=n.initialized_mixins;for(r in f)i=f[r],s.push(r);l.push(t.push({instance:n.mix_target,mixins:s}))}return l},e.prototype.classRecordGroupInstances=function(e,t){var n,r,i,s,o;if(!e.instance_records.length)return;t.hasOwnProperty(e.constructor.name)||(t[e.constructor]=[]),s=e.instance_records,o=[];for(r=0,i=s.length;r<i;r++)n=s[r],o.push(t[e.constructor].push(n.mix_target));return o},e.prototype.classRecordGetMixins=function(e,t,n){var r,i,s,o;s=e.mixins,o=[];for(r in s)i=s[r],o.push((t.hasOwnProperty(r)?void 0:t[r]=[],t[r].push(e.constructor)));return o},e}(),this.Mixin.STATISTICS&&(e._statistics=new e.Core.Statistics)}).call(this);